<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="apc.sl.basicInfo.prPerformance.service.impl.PrPerformanceMapper">

	<select id="selectPrPerformanceToCnt" resultType="int">
		select count(*) from sm_release_info 
		where 1=1
		<if test="searchKeyword != ''">
			and po_lotno LIKE CONCAT ('%', #{searchKeyword}, '%')
		</if>
		<if test="searchStDate != ''">
			AND rel_date >= #{searchStDate}
		</if>
		<if test="searchEdDate !=''">
			AND rel_date <![CDATA[<=]]>
			#{searchEdDate}
		</if>
	</select>

	<select id="selectPrPerformanceList" resultType="egovMap">

		SELECT rel_idx, po_lotno, rel_clgo, rel_compony, rel_prod,
		rel_qty FROM sm_release_info

		WHERE 1=1
		<if test="searchCondition == 1 and searchKeyword != ''">and po_lotno LIKE CONCAT ('%', #{searchKeyword}, '%')</if>
		<!-- <if test="searchKeyword != ''">
			and po_lotno LIKE CONCAT ('%', #{searchKeyword}, '%')
		</if> -->
		<if test="searchCondition == 2 and searchKeyword != ''">and or_id LIKE CONCAT ('%', #{searchKeyword}, '%')</if>
		<if test="searchStDate != ''">
			AND rel_clgo >= #{searchStDate}
		</if>
		<if test="searchEdDate !=''">
			AND rel_clgo <![CDATA[<=]]>
			#{searchEdDate}
		</if>
		ORDER BY rel_idx DESC
		OFFSET #{firstIndex} ROWS
		FETCH NEXT #{recordCountPerPage} ROWS ONLY

	</select>
	
	<select id="selectExistsPrPer" resultType="int">
	SELECT COUNT(*) FROM sm_product_info
	WHERE pi_id = #{piId}
	</select>
	
	<select id="selectPrPerDetail" resultType="egovMap">
	SELECT * FROM sm_release_info
		WHERE rel_idx = #{relIdx}
	</select>


	<insert id="registPrPerformance">
		insert into sm_release_info
		(
		po_lotno,
		or_id,
		rel_compony,
		rel_del,
		rel_esno,
		rel_prno,
		rel_clgo,
		rel_nabgi,
		rel_or_type,
		rel_qty,
		rel_unit,
		rel_price,
		rel_prod,
		rel_texture,
		rel_thickness,
		rel_standard,
		rel_state,
		rel_person,
		rel_report,
		rel_completion,
		rel_note1,
		rel_note2
		) values
		(
		#{poLotno},
		#{orId},
		#{relCompony},
		#{relDel},
		#{relEsno},
		#{relPrno},
		GETDATE(),
		#{relNabgi},
		#{relOrType},
		#{relQty},
		#{relUnit},
		#{relPrice},
		#{relProd},
		#{relTexture},
		#{relThickness},
		#{relStandard},
		#{relState},
		#{relPerson},
		#{relReport},
		#{relCompletion},
		#{relNote1},
		#{relNote2}
		)
	</insert>
	
	<update id="modifyPrPerformance">
	UPDATE sm_release_info SET
		rel_compony = #{relCompony},
		rel_del = #{relDel},
		rel_esno = #{relEsno},
		rel_prno = #{relPrno},
		rel_clgo = #{relClgo},
		rel_nabgi = #{relNabgi},
		rel_or_type = #{relOrType},
		rel_qty = #{relQty},
		rel_unit = #{relUnit},
		rel_price = #{relPrice},
		rel_prod = #{relProd},
		rel_texture = #{relTexture},
		rel_thickness = #{relThickness},
		rel_standard = #{relStandard},
		rel_state = #{relState},
		rel_person = #{relPerson},
		rel_report = #{relReport},
		rel_completion = #{relCompletion},
		rel_note1 = #{relNote1},
		rel_note2 = #{relNote2}
	WHERE rel_idx = #{relIdx}
	</update>
	
	<delete id="deletePrPerfomance">
	delete from sm_release_info where rel_idx = #{relIdx}
	</delete>

</mapper>